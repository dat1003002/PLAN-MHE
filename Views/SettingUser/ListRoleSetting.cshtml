@{
	ViewData["Title"] = "Danh Sách Loại Người Dùng";
}
<div class="main-box" style="margin-bottom:15px;">
	<div class="header-section">
		<div class="left-icon"><i class="ace-icon fa fa-star orange"></i></div>
		<div class="page-title">Danh Sách Loại Người Dùng</div>
		<div class="right-settings"><i class="fa fa-regular fa-gear"></i></div>
	</div>
</div>
<table>
	<thead>
		<tr class="mvc-grid-headers">
			<th style="width: 5%;">#</th>
			<th style="width: 42%;">Loại Người Dùng</th>
			<th style="width: 43%;">Ghi Chú</th>
			<th style="width: 10%;">HOẠT ĐỘNG</th>
		</tr>
	</thead>
	<tbody>
		@{
			int index = 1;
		}
		@foreach (var userType in Model)
		{
			<tr class="data-row">
				<td style="width: 5%;">@index</td>
				<td style="width: 42%;">@userType.FullName</td>
				<td style="width: 43%;">@userType.Note</td>
				<td style="width: 10%;">
					<button onclick="editUserType(@userType.Id, '@userType.FullName', '@userType.Note')" style="border-radius: 3px; background-color: #428BCA; color: white; border: 1px solid #2E6589; border-bottom-width: 2px; padding: 2px 6px;">
						<i class="ace-icon fa fa-edit bigger-120"></i>
					</button>
					<button onclick="deleteUserType(@userType.Id)" style="background-color: #C00000; color: white; border-radius: 3px; border: 1px solid #9c2c18; border-bottom-width: 2px; padding: 2px 6px;">
						<i class="ace-icon fa fa-trash bigger-120"></i>
					</button>
				</td>
			</tr>
			index++;
		}
	</tbody>
</table>
<div id="createModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
	<div class="modal-content" style="background: white; width: 90%; max-width: 500px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
		<div class="modal-header" style="background-color:#438DB8; padding: 5px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
			<button onclick="closeModal()" style="background: none; color: white; border: 2px solid white; font-size: 20px; cursor: pointer;">&times;</button>
		</div>
		<div class="modal-body" style="padding: 15px;">
			<input type="hidden" id="Id" />
			<div class="form-group" style="margin-bottom: 15px;">
				<label style="display: block; margin-bottom: 5px;">Loại Người Dùng (*)</label>
				<input type="text" id="FullName" style="width: 100%; padding: 3px; border: 1px solid #ddd; border-radius: 3px;" />
			</div>
			<div class="form-group" style="margin-bottom: 15px;">
				<label style="display: block; margin-bottom: 5px;">Ghi Chú</label>
				<input type="text" id="Note" style="width: 100%; padding: 3px; border: 1px solid #ddd; border-radius: 3px;" />
			</div>
		</div>
		<div class="modal-footer" style="padding: 5px; border-top: 1px solid #ddd; text-align: right;">
			<button onclick="saveUserType()" style="padding: 2px 10px; font-size: 13px; border: 1px solid #2E6589; border-radius: 3px; background: #428BCA; color: white; cursor: pointer;">
				<i class="ace-icon fa fa-save"></i>
				Lưu
			</button>
		</div>
	</div>
</div>
<div class="foter-category" style="position: fixed; bottom: 0; left: 0; width: 100%; background-color: #f8f9fa; padding: 16px; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); text-align: right; z-index: 1000;">
	<button onclick="openModal()" style="background:#428BCA; color: white; border-radius: 3px; border: 1px solid #2E6589; border-bottom-width: 4px; padding: 2px 6px; font-size: 13px; font-family: segoeui;">
		<i class="ace-icon fa fa-plus"></i>Tạo Mới
	</button>
</div>
<script>
	function openModal() {
		document.getElementById('createModal').style.display = 'flex';
		document.getElementById('Id').value = '';
		document.getElementById('FullName').value = '';
		document.getElementById('Note').value = '';
	}
	function closeModal() {
		document.getElementById('createModal').style.display = 'none';
	}
	function editUserType(id, fullName, note) {
		document.getElementById('createModal').style.display = 'flex';
		document.getElementById('Id').value = id;
		document.getElementById('FullName').value = fullName;
		document.getElementById('Note').value = note;
	}
	function saveUserType() {
		const id = document.getElementById('Id').value;
		const userType = {
			Id: id ? parseInt(id) : 0,
			FullName: document.getElementById('FullName').value,
			Note: document.getElementById('Note').value
		};
		const url = id ? '/SettingUser/UpdateUserType' : '/SettingUser/CreateUserType';
		const method = id ? 'PUT' : 'POST';
		fetch(url, {
			method: method,
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(userType)
		})
		.then(response => response.json())
		.then(data => {
			alert(data.message);
			closeModal();
			location.reload();
		})
		.catch(error => {
			alert('Lỗi khi lưu loại người dùng: ' + error);
		});
	}
	function deleteUserType(id) {
		if (!id || isNaN(id) || id <= 0) {
			alert('ID loại người dùng không hợp lệ!');
			return;
		}
		console.log('Deleting UserType with ID:', id);
		if (confirm('Bạn có chắc muốn xóa loại người dùng này?')) {
			fetch('/SettingUser/DeleteUserType', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({ Id: id })
			})
			.then(response => {
				console.log('Response status:', response.status);
				if (!response.ok) {
					return response.json().then(err => { throw new Error(err.message || response.statusText); });
				}
				return response.json();
			})
			.then(data => {
				alert(data.message);
				location.reload();
			})
			.catch(error => {
				console.error('Error:', error);
				alert('Lỗi khi xóa loại người dùng: ' + error.message);
			});
		}
	}
</script>
