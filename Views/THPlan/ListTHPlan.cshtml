@model IEnumerable<PLANMHE.Models.Plan>

@{
    ViewData["Title"] = "Thực Hiện Kế Hoạch";

    int currentPage = ViewBag.CurrentPage ?? 1;
    int totalPages = ViewBag.TotalPages ?? 1;
    string search = ViewBag.Search ?? "";
    int sttStart = (currentPage - 1) * 10 + 1;
}

<div class="main-box">
    <div class="header-section">
        <div class="left-icon"><i class="ace-icon fa fa-star orange"></i></div>
        <div class="page-title">Danh Sách Kế Hoạch Đang Thực Hiện</div>
        <div class="right-settings"><i class="fa fa-regular fa-gear"></i></div>
    </div>
</div>

@if (TempData["WarningMessage"] != null)
{
    <div class="alert alert-warning" style="margin: 20px; padding: 10px; border-radius: 3px; background-color: #fcf8e3; border-color: #faebcc; color: #8a6d3b;">
        <strong>Cảnh báo:</strong> @TempData["WarningMessage"]
    </div>
}

<div class="main-container">
    <div class="search-area">
        <input type="text" id="searchUsername" placeholder="Tên Kế Hoạch" value="@search">
    </div>
    <div class="options">
        <label><input type="radio" name="status" value="all" checked> Tất cả</label>
        <label class="status-using"><input type="radio" name="status" value="active"> Đang thực hiện</label>
        <label class="status-deleted"><input type="radio" name="status" value="completed"> Đã Hoàn Thành</label>
    </div>
</div>

<table id="planTable">
    <thead>
        <tr class="mvc-grid-headers">
            <th style="width: 5%;">STT</th>
            <th style="width: 30%;">Tên Kế Hoạch</th>
            <th style="width: 15%;">Ngày Bắt Đầu</th>
            <th style="width: 15%;">Ngày Kết Thúc</th>
            <th style="width: 15%;">Trạng thái</th>
        </tr>
    </thead>
    <tbody>
        @if (Model != null && Model.Any())
        {
            int stt = sttStart;
            foreach (var plan in Model)
            {
                <tr class="data-row" data-status="@plan.Status.ToLower()" data-name="@plan.Name.ToLower()">
                    <td style="width: 5%;">@stt</td>
                    <td style="width: 30%;">
                        <a href="@Url.Action("Detail", "THPlan", new { id = plan.Id })">@plan.Name</a>
                    </td>
                    <td style="width: 15%;">@plan.StartDate.ToString("dd/MM/yyyy")</td>
                    <td style="width: 15%;">@plan.EndDate.ToString("dd/MM/yyyy")</td>
                    <td style="width: 15%;">
                        @if (plan.Status == "Active")
                        {
                            <button class="status-button" style="background-color: #28a745; color: white; border: 1px solid #28a745; padding: 1px 3px; border-radius: 5px; cursor: default; font-size: 10px;">
                                Đang thực hiện
                            </button>
                        }
                        else if (plan.Status == "Completed")
                        {
                            <button class="status-button" style="background-color: #dc3545; color: white; border: 1px solid #c82333; padding: 1px 3px; border-radius: 5px; cursor: default; font-size: 10px;">
                                Đã Hoàn Thành
                            </button>
                        }
                        else
                        {
                            <span>@plan.Status</span>
                        }
                    </td>
                </tr>
                stt++;
            }
        }
        else
        {
            <tr>
                <td colspan="5">Không có kế hoạch nào.</td>
            </tr>
        }
    </tbody>
</table>

<!-- PHÂN TRANG -->
<div style="display: flex; justify-content: center; margin-top: 20px;">
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("ListTHPlan", new { search = search, pageNumber = currentPage - 1 })" aria-label="Previous">
                    <span aria-hidden="true">«</span>
                </a>
            </li>
            @for (int i = 1; i <= totalPages; i++)
            {
                <li class="page-item @(i == currentPage ? "active" : "")">
                    <a class="page-link" href="@Url.Action("ListTHPlan", new { search = search, pageNumber = i })">@i</a>
                </li>
            }
            <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("ListTHPlan", new { search = search, pageNumber = currentPage + 1 })" aria-label="Next">
                    <span aria-hidden="true">»</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const radioButtons = document.querySelectorAll('input[name="status"]');
        const searchInput = document.querySelector('#searchUsername');
        const tableRows = document.querySelectorAll('#planTable .data-row');

        function filterPlans() {
            const selectedStatus = document.querySelector('input[name="status"]:checked').value;
            const searchQuery = searchInput.value.trim().toLowerCase();

            tableRows.forEach(row => {
                const rowStatus = row.getAttribute('data-status');
                const rowName = row.getAttribute('data-name');

                const matchesStatus = selectedStatus === 'all' || rowStatus === selectedStatus;
                const matchesSearch = searchQuery === '' || rowName.includes(searchQuery);

                row.style.display = (matchesStatus && matchesSearch) ? '' : 'none';
            });
        }

        radioButtons.forEach(radio => radio.addEventListener('change', filterPlans));
        searchInput.addEventListener('input', filterPlans);

        filterPlans();
    });
</script>
